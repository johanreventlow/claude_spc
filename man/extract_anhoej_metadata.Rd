% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fct_anhoej_rules.R
\name{extract_anhoej_metadata}
\alias{extract_anhoej_metadata}
\title{Extract Anhøj Rules Metadata from BFHchart Output}
\usage{
extract_anhoej_metadata(qic_data)
}
\arguments{
\item{qic_data}{data.frame or tibble. BFHchart qic_data with Anhøj columns.
Must contain at least: \code{runs.signal}, \code{n.crossings}, \code{n.crossings.min}.
Optional: \code{longest.run}, \code{longest.run.max}, \code{anhoej.signal}.}
}
\value{
list with Anhøj rules metadata:
\describe{
\item{runs_signal}{logical. TRUE if any runs violation detected.}
\item{crossings_signal}{logical. TRUE if crossings violation detected.}
\item{n_crossings}{numeric. Actual number of crossings (first value if per-phase).}
\item{n_crossings_min}{numeric. Minimum expected crossings (first value if per-phase).}
\item{longest_run}{integer. Length of longest run (if available).}
\item{longest_run_max}{numeric. Maximum acceptable run (if available).}
\item{signal_points}{logical vector. Per-point combined Anhøj signal.}
}
Returns NULL if required columns missing (with warning).
}
\description{
Extracts standardized Anhøj rules metadata from BFHchart qic_data.
BFHchart already computes Anhøj rules (runs and crossings tests), so this
function simply extracts and formats the results into a consistent structure
matching qicharts2 conventions.
}
\details{
\strong{BFHchart Anhøj Columns:}
\itemize{
\item \code{runs.signal}: Logical indicating if runs test triggered (≥8 consecutive points)
\item \code{longest.run}: Length of longest run above or below center line
\item \code{longest.run.max}: Maximum acceptable run length
\item \code{n.crossings}: Actual number of median crossings observed
\item \code{n.crossings.min}: Minimum expected crossings (statistical threshold)
\item \code{anhoej.signal}: Combined signal (TRUE if runs OR crossings violation)
}

\strong{Output Standardization:}
This function extracts per-point signals and aggregates to overall metadata
matching the baseline fixture structure from Task #29.

\strong{Per-Phase Handling:}
If data contains multiple phases (part column), Anhøj rules are applied
per-phase by BFHchart. This function preserves per-point signals and
returns overall status.
}
\examples{
\dontrun{
# Extract from BFHchart result
bfh_result <- BFHcharts::create_spc_chart(data, x, y, chart_type = "run")
qic_data <- bfh_result$data
anhoej_meta <- extract_anhoej_metadata(qic_data)

# Check if rules triggered
if (anhoej_meta$runs_signal) {
  message("Runs violation detected!")
}
if (anhoej_meta$crossings_signal) {
  message("Too few crossings detected!")
}

# Access per-point signals
signal_indices <- which(anhoej_meta$signal_points)
}

}
\seealso{
\code{\link{validate_anhoej_columns}} for input validation
\code{\link{compute_spc_results_bfh}} for integration in service layer
}
