% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fct_spc_bfh_service.R
\name{transform_bfh_output}
\alias{transform_bfh_output}
\title{Transform BFHchart Output to Standardized Format}
\usage{
transform_bfh_output(
  bfh_result,
  multiply = 1,
  chart_type = NULL,
  original_data = NULL,
  freeze_applied = FALSE
)
}
\arguments{
\item{bfh_result}{ggplot2 object from BFHchart.}

\item{multiply}{numeric. Multiplier to apply to y-axis values. Default 1.
Common use: 100 for percentage display.}

\item{chart_type}{character. Chart type for metadata. Used in diagnostic logging.}

\item{original_data}{data.frame. Original input data for comment mapping and
row count validation. Optional but recommended.}

\item{freeze_applied}{logical. Whether freeze was applied in parameter mapping.
Default FALSE. Used to set metadata correctly since BFHcharts doesn't return
a freeze column.}
}
\value{
list with three components:
\describe{
\item{plot}{ggplot2 object compatible with SPCify customization}
\item{qic_data}{tibble with standardized SPC data (qicharts2 format)}
\item{metadata}{list with chart configuration and diagnostics}
}
Returns NULL on transformation failure (with error logging).
}
\description{
Converts BFHchart output (ggplot object) to SPCify's standardized
format matching qicharts2 structure. Ensures output compatibility with
existing SPCify plot rendering, customization, and export functions.
}
\details{
\strong{Transformation Responsibilities:}
\itemize{
\item Extract qic_data from ggplot object layers
\item Standardize column names (BFHchart → SPCify conventions)
\item Apply multiply scaling to y-axis values
\item Calculate combined Anhøj signal if not provided by BFHchart
\item Ensure required columns present: x, y, cl, ucl, lcl, part, signal
\item Preserve \code{.original_row_id} for comment mapping
\item Build metadata list with diagnostic information
}

\strong{Output Structure (qicharts2-compatible):}
\itemize{
\item \code{qic_data} tibble with standardized columns
\item \code{plot} ggplot2 object
\item \code{metadata} list with configuration and diagnostics
}

\strong{Anhøj Signal Calculation:}
If BFHchart does not provide combined signal, calculate as:
\code{signal <- runs.signal | crossings.signal}
Applied per-phase if part column present.
}
\examples{
\dontrun{
# Transform BFHchart plot output
bfh_result <- call_bfh_chart(bfh_params)
standardized <- transform_bfh_output(
  bfh_result = bfh_result,
  multiply = 100,
  chart_type = "p",
  original_data = clean_data
)

# Access standardized components
print(standardized$plot)
summary(standardized$qic_data)
print(standardized$metadata$signals_detected)

# Use with existing SPCify functions
customized_plot <- apply_hospital_theme(standardized$plot)
export_plot(customized_plot, filename = "spc_chart.png")
}

}
\seealso{
\code{\link{compute_spc_results_bfh}} for facade interface
\code{\link{call_bfh_chart}} for BFHchart invocation
\code{\link{add_comment_annotations}} for comment layer
}
